# 摄像头拉流功能测试说明

## 测试环境准备

### 1. ZLMediaKit服务器
- **服务地址**: http://35.46.5.76:8080
- **管理界面**: http://35.46.5.76:8080/webassist/?secret=MKjn33mg82zrW8TIleMSDlbdxhmhP6yZ
- **API文档**: http://35.46.5.76:8080/swagger/#/
- **确保服务正常运行**

### 2. 数据库准备
执行以下SQL脚本初始化摄像头表：
```bash
# 在数据库中执行 sql/camera.sql
mysql -u root -p < sql/camera.sql
```

### 3. 后端服务启动
```bash
# 在项目根目录执行
mvn clean compile
mvn spring-boot:run
```

### 4. 前端服务启动
```bash
# 进入前端目录
cd yulo-ui
# 安装依赖（首次运行）
npm install
# 启动开发服务器
npm run dev
```

## 拉流功能测试步骤

### 1. 界面功能测试

1. **访问摄像头管理页面**
   - 登录系统
   - 进入设备管理 -> 摄像头管理
   - 确认页面显示拉流状态列

2. **添加测试摄像头**
   ```json
   {
     "cameraCode": "test_camera_001",
     "cameraName": "测试摄像头",
     "videoSource": "rtsp://admin:password@192.168.1.100:554/stream1",
     "mediaProxy": "rotanova_server_node",
     "status": "1"
   }
   ```

3. **测试拉流操作**
   - 点击"开始拉流"按钮
   - 观察按钮状态变化
   - 检查拉流状态列显示
   - 点击"停止拉流"按钮
   - 确认状态更新

### 2. API接口测试

使用提供的测试脚本：
```bash
# 给脚本执行权限
chmod +x test-camera-stream-api.sh
# 运行测试
./test-camera-stream-api.sh
```

### 3. 可视化测试

1. **打开测试页面**
   ```bash
   # 在浏览器中打开
   open test-camera-stream.html
   ```

2. **填写测试参数**
   - 摄像头编号：test_camera_001
   - 视频源地址：rtsp://admin:password@192.168.1.100:554/stream1
   - 媒体代理：rotanova_server_node

3. **执行测试操作**
   - 点击"开始拉流"
   - 点击"查询状态"
   - 观察视频播放区域
   - 点击"停止拉流"

### 4. ZLMediaKit管理界面验证

1. **访问管理界面**
   - 打开：http://35.46.5.76:8080/webassist/?secret=MKjn33mg82zrW8TIleMSDlbdxhmhP6yZ
   - 查看流媒体信息

2. **验证拉流状态**
   - 在"流媒体"页面查看活跃流
   - 确认摄像头流是否存在
   - 测试播放功能

## 测试用例

### 用例1：正常拉流流程
1. **前置条件**：摄像头RTSP地址可访问
2. **测试步骤**：
   - 开始拉流
   - 查询状态（应为active）
   - 停止拉流
   - 再次查询状态（应为inactive）
3. **预期结果**：所有操作成功，状态正确

### 用例2：异常RTSP地址
1. **前置条件**：使用无效的RTSP地址
2. **测试步骤**：尝试开始拉流
3. **预期结果**：返回错误信息，拉流失败

### 用例3：重复拉流
1. **前置条件**：摄像头已在拉流中
2. **测试步骤**：再次开始拉流
3. **预期结果**：按钮禁用或提示已在拉流

### 用例4：网络异常
1. **前置条件**：ZLMediaKit服务不可访问
2. **测试步骤**：尝试任何拉流操作
3. **预期结果**：显示网络错误信息

## 预期结果

### 1. 界面功能
- ✅ 拉流状态列正确显示
- ✅ 开始/停止拉流按钮正常工作
- ✅ 按钮状态根据拉流状态正确启用/禁用
- ✅ 操作成功/失败消息正确显示

### 2. API响应
- ✅ 开始拉流：返回成功状态
- ✅ 停止拉流：返回成功状态
- ✅ 查询状态：返回正确的拉流状态信息

### 3. ZLMediaKit集成
- ✅ 成功调用ZLMediaKit API
- ✅ 流媒体服务器显示活跃流
- ✅ 可通过播放地址观看视频

## 常见问题排查

### 1. 拉流失败
- **检查RTSP地址**：确认摄像头地址可访问
- **检查网络连通性**：ping ZLMediaKit服务器
- **查看日志**：检查后端日志错误信息

### 2. 状态查询异常
- **检查ZLMediaKit服务**：确认服务正常运行
- **检查API密钥**：确认secret配置正确
- **检查摄像头编号**：确认编号格式正确

### 3. 前端按钮异常
- **检查权限配置**：确认用户有拉流权限
- **检查API调用**：查看浏览器网络请求
- **检查状态更新**：确认状态查询正常

### 4. 视频播放问题
- **检查播放地址**：确认URL格式正确
- **检查浏览器支持**：某些格式需要特定插件
- **检查网络**：确认可访问播放地址

## 性能测试

### 1. 并发拉流测试
- 同时启动多个摄像头拉流
- 观察服务器资源使用情况
- 测试系统稳定性

### 2. 长时间运行测试
- 持续拉流24小时
- 监控内存泄漏
- 检查连接稳定性

## 测试报告模板

```
测试时间：____
测试人员：____
测试环境：____

功能测试结果：
□ 开始拉流功能 - 通过/失败
□ 停止拉流功能 - 通过/失败  
□ 状态查询功能 - 通过/失败
□ 界面状态更新 - 通过/失败

异常测试结果：
□ 无效RTSP地址 - 通过/失败
□ 网络异常处理 - 通过/失败
□ 重复操作处理 - 通过/失败

发现问题：
1. ____
2. ____

建议改进：
1. ____
2. ____
```