# 区域绘制功能快速开始指南

## 快速开始

### 1. 启动测试页面（最快方式）

```bash
# 直接在浏览器中打开测试页面
open test-region-draw.html
```

这是最快的测试方式，无需启动任何服务，可以立即体验区域绘制功能。

### 2. 在系统中使用

#### 步骤1：确保数据库已更新

```bash
# 检查 camera_url 字段是否存在
mysql -u root -p your_database -e "SHOW COLUMNS FROM camera LIKE 'camera_url';"

# 如果不存在，执行升级脚本
mysql -u root -p your_database < sql/camera_update.sql
```

#### 步骤2：启动后端服务

```bash
# 启动Spring Boot应用
./ry.sh
```

#### 步骤3：启动前端服务

```bash
# 进入前端目录并启动
cd yulo-ui
npm run dev
```

#### 步骤4：访问AI设置页面

1. 打开浏览器访问：http://localhost:80
2. 登录系统
3. 进入"AI设置"菜单
4. 找到任意摄像头，点击"区域绘制"按钮

## 基本操作

### 1. 新增区域

```
选择区域类型（如"车道区"）
  ↓
点击"新增"按钮
  ↓
区域列表显示新区域编号
```

### 2. 绘制区域

```
选中区域（点击区域编号）
  ↓
点击"开始绘制"按钮
  ↓
在视频画面上点击标记顶点（至少3个点）
  ↓
点击"结束绘制"按钮
  ↓
区域绘制完成
```

### 3. 保存区域

```
确保所有区域都已绘制完成
  ↓
点击"保存区域"按钮
  ↓
系统保存到数据库
  ↓
提示保存成功
```

## 区域类型说明

| 类型 | 说明 | 用途 |
|------|------|------|
| 车道区 | 定义车道范围 | 用于车辆检测和车道分析 |
| 实线 | 定义实线位置 | 用于压实线检测 |
| 拥堵区 | 定义拥堵检测区域 | 用于拥堵检测 |
| 禁行区 | 定义禁止通行区域 | 用于违规检测 |
| 人、非机械禁区 | 定义行人和非机动车禁入区域 | 用于入侵检测 |
| 车辆屏蔽区 | 定义车辆屏蔽区域 | 用于排除干扰 |
| 拥堵统计区 | 定义拥堵统计区域 | 用于拥堵统计分析 |
| 禁停区 | 定义禁止停车区域 | 用于违停检测 |

## 常用操作

### 删除区域

```
鼠标悬停在区域编号上
  ↓
点击右上角的删除按钮（×）
  ↓
区域被删除
```

### 选中区域

```
点击区域编号
  ↓
区域高亮显示（绿色变为蓝色）
  ↓
可以开始绘制或编辑
```

### 编辑区域属性

```
选中区域
  ↓
点击"编辑区域属性"按钮
  ↓
修改车道方向、车道类型、限速等
  ↓
点击确定保存
```

## 快捷提示

### ✅ 正确操作

- 先选择区域类型，再点击新增
- 先选中区域，再开始绘制
- 至少标记3个点才能结束绘制
- 所有区域绘制完成后再保存

### ❌ 常见错误

- 未选择区域类型就点击新增
- 未选中区域就开始绘制
- 标记少于3个点就结束绘制
- 有未绘制的区域就点击保存

## 数据示例

### 车道区示例

```json
{
  "id": 1,
  "type": "Lane",
  "typeName": "车道区",
  "points": [[200, 300], [800, 300], [800, 600], [200, 600]],
  "direction": "up",
  "laneType": "lane",
  "minSpeed": 60,
  "maxSpeed": 120
}
```

### 禁停区示例

```json
{
  "id": 2,
  "type": "parking_area",
  "typeName": "禁停区",
  "points": [[100, 100], [400, 100], [400, 250], [100, 250]],
  "direction": "up",
  "laneType": "lane",
  "minSpeed": null,
  "maxSpeed": null
}
```

## 视频教程

### 1. 第一次使用

1. 打开 test-region-draw.html
2. 选择"车道区"
3. 点击"新增区域"
4. 点击区域编号"1"
5. 点击"开始绘制"
6. 在视频上点击4个点（矩形）
7. 点击"结束绘制"
8. 点击"保存区域"

### 2. 添加多个区域

1. 选择"拥堵区"
2. 点击"新增区域"
3. 点击区域编号"2"
4. 点击"开始绘制"
5. 在视频上点击多个点
6. 点击"结束绘制"
7. 重复以上步骤添加更多区域
8. 点击"保存区域"

### 3. 编辑和删除

1. 鼠标悬停在区域编号上
2. 点击删除按钮删除区域
3. 或者点击区域编号选中
4. 点击"编辑区域属性"修改属性

## 故障排除

### 问题1：视频无法播放

**原因**：camera_url 字段为空或地址无效

**解决**：
```sql
-- 检查 camera_url 字段
SELECT id, camera_code, camera_url FROM camera;

-- 更新 camera_url
UPDATE camera SET camera_url = 'http://35.46.5.76:8080/live/350000007132901001.live.mp4' WHERE id = 1;
```

### 问题2：画布尺寸不正确

**原因**：视频未加载完成

**解决**：等待视频加载完成后再绘制，或刷新页面

### 问题3：点击位置不准确

**原因**：坐标转换问题

**解决**：确保画布使用正确的缩放比例计算

### 问题4：保存失败

**原因**：后端服务未启动或API异常

**解决**：
```bash
# 检查后端服务
curl http://localhost:8080/device/camera/list

# 查看后端日志
tail -f logs/sys-info.log
```

## 进阶使用

### 1. 导出区域数据

在测试页面中：
```
点击"导出数据"按钮
  ↓
下载 JSON 文件
  ↓
可以用于备份或分享
```

### 2. 批量配置

```sql
-- 将一个摄像头的区域配置复制到另一个摄像头
UPDATE camera 
SET regions = (SELECT regions FROM camera WHERE id = 1)
WHERE id = 2;
```

### 3. 查看区域数据

```sql
-- 查看某个摄像头的区域配置
SELECT id, camera_code, regions FROM camera WHERE id = 1;

-- 格式化显示
SELECT id, camera_code, JSON_PRETTY(regions) FROM camera WHERE id = 1;
```

## 性能优化建议

### 1. 减少区域数量

- 每个摄像头建议不超过10个区域
- 合并相邻的同类型区域
- 删除不必要的区域

### 2. 简化多边形

- 使用最少的顶点数
- 避免过于复杂的形状
- 矩形优于不规则多边形

### 3. 定期清理

- 删除不再使用的区域
- 更新过时的区域配置
- 备份重要的区域数据

## 最佳实践

### 1. 命名规范

虽然当前版本使用数字编号，但建议在备注中记录区域用途：
- 区域1：主车道
- 区域2：应急车道
- 区域3：禁停区

### 2. 绘制顺序

建议按以下顺序绘制：
1. 先绘制车道区
2. 再绘制实线
3. 最后绘制检测区域

### 3. 测试验证

绘制完成后：
1. 检查区域是否覆盖正确
2. 测试AI检测是否生效
3. 根据实际效果调整区域

## 下一步

完成基本操作后，可以：

1. 查看 [区域绘制功能实现说明.md](./区域绘制功能实现说明.md) 了解技术细节
2. 查看 [区域绘制功能测试说明.md](./区域绘制功能测试说明.md) 进行完整测试
3. 在实际项目中配置摄像头的区域
4. 根据AI检测效果优化区域配置

## 技术支持

如有问题，请：

1. 查看浏览器控制台的错误信息
2. 查看后端日志文件
3. 参考测试说明文档
4. 联系技术支持团队

## 更新日志

### v1.0.0 (2025-10-23)

- ✅ 实现基本的区域绘制功能
- ✅ 支持8种区域类型
- ✅ 支持多区域管理
- ✅ 支持数据保存和加载
- ✅ 提供独立测试页面
- ✅ 完整的文档和测试说明

### 待实现功能

- ⏳ 区域编辑功能
- ⏳ 区域模板功能
- ⏳ 批量导入导出
- ⏳ 撤销和重做
- ⏳ 快捷键支持
