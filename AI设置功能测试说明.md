# AI设置功能测试说明

## 测试环境准备

### 1. 数据库准备

执行数据库升级脚本（如果是现有系统）：

```bash
mysql -u root -p yulo_db < sql/camera_update.sql
```

或者重新创建表（如果是新系统）：

```bash
mysql -u root -p yulo_db < sql/camera.sql
```

### 2. 后端服务启动

确保后端服务正常运行：

```bash
# 在项目根目录执行
./ry.sh
# 或者
java -jar target/ruoyi-admin.jar
```

### 3. 前端服务启动

```bash
cd yulo-ui
npm run dev
```

## 功能测试用例

### 测试用例 1：页面访问测试

**测试步骤：**
1. 登录系统
2. 访问 AI设置 页面（路径：/ai-settings）

**预期结果：**
- 页面正常加载
- 显示摄像头列表
- 显示搜索栏和提示信息

### 测试用例 2：摄像头列表展示测试

**测试步骤：**
1. 进入 AI设置 页面
2. 查看摄像头列表

**预期结果：**
- 显示所有摄像头信息
- 每行显示：序号、摄像头状态、编号、AI功能配置、操作按钮
- 在线摄像头显示绿色图标，离线摄像头显示红色图标

### 测试用例 3：搜索功能测试

**测试步骤：**
1. 在"算法设计"搜索框输入摄像头编号：350000007132901001
2. 观察列表变化
3. 清空搜索框
4. 输入摄像头名称关键字：AK10

**预期结果：**
- 输入编号后，只显示匹配的摄像头
- 输入名称后，显示所有包含关键字的摄像头
- 清空搜索框后，显示所有摄像头

### 测试用例 4：启用人机非行为分析

**测试步骤：**
1. 找到第一个摄像头
2. 勾选"人机非行为分析"复选框
3. 点击右侧箭头展开详细配置
4. 勾选以下项目：
   - 违法停车
   - 违法倒车
   - 拥堵
   - 低速
   - 行人入侵
   - 交通流量
5. 等待保存成功提示

**预期结果：**
- 复选框状态正确切换
- 展开后显示所有可配置项
- 勾选的项目被正确标记
- 显示"AI 功能配置更新成功"提示
- 刷新页面后配置保持不变

### 测试用例 5：启用场景分析

**测试步骤：**
1. 找到第一个摄像头
2. 勾选"场景分析"复选框
3. 点击右侧箭头展开详细配置
4. 勾选以下项目：
   - 施工区域
   - 遗留物
   - 火灾
   - 烟雾
   - 事故
5. 等待保存成功提示

**预期结果：**
- 复选框状态正确切换
- 展开后显示所有可配置项
- 勾选的项目被正确标记
- 显示"AI 功能配置更新成功"提示
- 刷新页面后配置保持不变

### 测试用例 6：查看偏移对照图

**测试步骤：**
1. 找到有偏移对照图的摄像头（350000007132901001）
2. 点击操作列的图片图标按钮
3. 在弹出的对话框中查看图片
4. 点击图片进行放大
5. 关闭对话框

**预期结果：**
- 对话框正常弹出
- 图片正常显示
- 点击图片可以放大查看
- 关闭对话框后页面恢复正常

### 测试用例 7：无偏移对照图测试

**测试步骤：**
1. 找到没有偏移对照图的摄像头（350000007132901002）
2. 观察图片图标按钮状态

**预期结果：**
- 图片图标按钮显示为禁用状态（灰色）
- 鼠标悬停时显示禁用样式
- 点击按钮无反应

### 测试用例 8：区域绘制按钮测试

**测试步骤：**
1. 点击任意摄像头的"区域绘制"按钮

**预期结果：**
- 显示提示信息："区域绘制功能暂未实现"

### 测试用例 9：配置取消测试

**测试步骤：**
1. 找到已启用AI功能的摄像头
2. 取消勾选"人机非行为分析"复选框
3. 等待保存成功提示
4. 刷新页面验证

**预期结果：**
- 复选框状态正确切换为未选中
- 显示"AI 功能配置更新成功"提示
- 刷新页面后配置保持未选中状态

### 测试用例 10：数据库验证测试

**测试步骤：**
1. 配置一个摄像头的AI功能
2. 连接数据库查询该摄像头记录：
```sql
SELECT ai_function FROM camera WHERE camera_code = '350000007132901001';
```

**预期结果：**
- ai_function 字段包含正确的 JSON 数据
- JSON 格式正确，可以被解析
- enable 和 attributes 字段值与页面配置一致

## 性能测试

### 测试用例 11：大量数据加载测试

**测试步骤：**
1. 在数据库中插入 100 条摄像头记录
2. 访问 AI设置 页面
3. 记录页面加载时间

**预期结果：**
- 页面在 3 秒内完成加载
- 列表正常显示所有数据
- 滚动流畅，无卡顿

### 测试用例 12：频繁配置更新测试

**测试步骤：**
1. 快速连续勾选/取消多个AI功能项
2. 观察系统响应

**预期结果：**
- 每次操作都能正确保存
- 不会出现配置丢失
- 不会出现错误提示

## 兼容性测试

### 浏览器兼容性

测试以下浏览器：
- Chrome (最新版本)
- Firefox (最新版本)
- Safari (最新版本)
- Edge (最新版本)

**预期结果：**
- 所有浏览器中页面显示正常
- 功能运行正常
- 样式一致

### 响应式测试

测试以下分辨率：
- 1920x1080 (桌面)
- 1366x768 (笔记本)
- 1280x720 (小屏幕)

**预期结果：**
- 不同分辨率下页面布局合理
- 内容不会被截断
- 操作按钮可正常点击

## 异常测试

### 测试用例 13：网络异常测试

**测试步骤：**
1. 配置AI功能
2. 在保存过程中断开网络
3. 观察系统反应

**预期结果：**
- 显示错误提示："AI 功能配置更新失败"
- 页面不会崩溃
- 重新连接网络后可以继续操作

### 测试用例 14：无效数据测试

**测试步骤：**
1. 在数据库中插入 ai_function 字段为无效 JSON 的记录
2. 访问 AI设置 页面

**预期结果：**
- 页面正常加载
- 该摄像头显示默认配置（所有功能未启用）
- 控制台输出解析错误日志

### 测试用例 15：图片加载失败测试

**测试步骤：**
1. 修改数据库中的 background_snap 为无效 URL
2. 点击查看偏移对照图

**预期结果：**
- 对话框正常打开
- 显示图片加载失败提示
- 不会影响其他功能

## 测试报告模板

```
测试日期：____年__月__日
测试人员：________
测试环境：________

| 测试用例编号 | 测试项目 | 测试结果 | 备注 |
|-------------|---------|---------|------|
| TC-01 | 页面访问测试 | ☐ 通过 ☐ 失败 | |
| TC-02 | 摄像头列表展示测试 | ☐ 通过 ☐ 失败 | |
| TC-03 | 搜索功能测试 | ☐ 通过 ☐ 失败 | |
| TC-04 | 启用人机非行为分析 | ☐ 通过 ☐ 失败 | |
| TC-05 | 启用场景分析 | ☐ 通过 ☐ 失败 | |
| TC-06 | 查看偏移对照图 | ☐ 通过 ☐ 失败 | |
| TC-07 | 无偏移对照图测试 | ☐ 通过 ☐ 失败 | |
| TC-08 | 区域绘制按钮测试 | ☐ 通过 ☐ 失败 | |
| TC-09 | 配置取消测试 | ☐ 通过 ☐ 失败 | |
| TC-10 | 数据库验证测试 | ☐ 通过 ☐ 失败 | |
| TC-11 | 大量数据加载测试 | ☐ 通过 ☐ 失败 | |
| TC-12 | 频繁配置更新测试 | ☐ 通过 ☐ 失败 | |
| TC-13 | 网络异常测试 | ☐ 通过 ☐ 失败 | |
| TC-14 | 无效数据测试 | ☐ 通过 ☐ 失败 | |
| TC-15 | 图片加载失败测试 | ☐ 通过 ☐ 失败 | |

总体评价：
- 通过率：____%
- 主要问题：
- 改进建议：
```

## 常见问题排查

### 问题 1：页面无法加载

**可能原因：**
- 路由配置错误
- 组件路径错误
- 权限不足

**排查步骤：**
1. 检查浏览器控制台错误信息
2. 检查路由配置
3. 检查用户权限

### 问题 2：AI功能配置无法保存

**可能原因：**
- 后端接口异常
- 数据格式错误
- 数据库连接问题

**排查步骤：**
1. 检查浏览器 Network 面板
2. 检查后端日志
3. 检查数据库连接

### 问题 3：偏移对照图无法显示

**可能原因：**
- 图片 URL 无效
- 图片服务器不可访问
- 跨域问题

**排查步骤：**
1. 在浏览器中直接访问图片 URL
2. 检查图片服务器状态
3. 检查跨域配置
