# AI设置区域命名功能说明

## 更新内容

### 1. 区域类型更新
已将区域类型更新为与 `typejson` 文件夹中的类型完全一致：

| 显示名称 | type 值 | 对应文件 |
|---------|---------|---------|
| 车道区 | Lane | 车道区.json |
| 实线 | solidLine | 实线.json |
| 拥堵触发区域 | CongestionTriggerRegion | 拥堵触发区域.json |
| 禁行区 | ProhibitedRegion | 禁行区.json |
| 人、非机屏蔽区 | ShieldRegion | 人、非机屏蔽区.json |
| 车辆屏蔽区 | VehicleShieldRegion | 车辆屏蔽区.json |
| 车流统计区 | TrafficFlowCountRegion | 车流统计区.json |
| 遗撒物屏蔽区 | remnantsShieldRegion | 遗撒物屏蔽区.json |

### 2. 区域命名功能
新增区域命名对话框，用户在添加区域时需要输入：
- **区域类型**: 自动显示（禁用状态），展示当前选择的区域类型
- **区域名称**: 用户输入（如：1、2、99等），name 和 value 字段使用同一个值

#### 车道区特殊字段
当区域类型为"车道区"时，需要额外填写：
- **车道方向**（必填）：up（向上）、down（向下）、right（向右）、left（向左）
- **车道类型**（必填）：drivingLane（行车道）、emergencyLane（应急车道）、driverslon（导流区）
- **最低限速**（可选）：数字输入
- **最高限速**（可选）：数字输入

这些字段会保存到区域的 attributes 对象中，与 typejson 文件格式保持一致。

### 3. 区域编辑功能
- 每个区域卡片右下角有编辑按钮（黄色圆形图标）
- 点击编辑按钮可以修改区域名称
- 编辑时会显示当前区域类型（禁用状态）
- 修改后自动更新画布上的显示

### 4. 区域重置功能
- 已绘制的区域左下角显示重置按钮（灰色圆形图标）
- 点击重置按钮可以清空该区域的绘制点
- 重置后可以重新绘制该区域

### 5. 绘制状态保护
- 当有区域正在绘制时：
  - 其他区域无法被选中（显示为灰色，半透明）
  - 禁止新增新的区域（新增按钮禁用）
  - 禁止保存区域（保存按钮禁用）
  - 禁止编辑区域名称
  - 区域类型选择器禁用
- 当正在绘制的区域被删除时：
  - 自动结束绘制状态
  - 恢复所有功能（新增、保存、编辑）

### 6. 顶点拖拽调整功能
- 鼠标悬停在顶点上时，光标变为移动图标
- 按住鼠标左键可以拖拽顶点调整区域范围
- 支持拖拽已保存区域的顶点
- 支持拖拽正在绘制中的顶点
- 拖拽时实时更新区域显示
- 顶点带有白色边框，更容易识别和操作

### 3. 数据格式
提交到数据库的区域数据格式完全符合 typejson 规范：

```json
[
  {
    "name": "1",
    "value": "1",
    "type": "Lane",
    "attributes": {
      "lane_direction": "down",
      "lane_type": "drivingLane",
      "min_speed": 60,
      "max_speed": 120
    },
    "points": [
      {
        "x": 0.35223024006870135,
        "y": 0.9958334177511782
      },
      ...
    ]
  },
  {
    "name": "99",
    "value": "99",
    "type": "solidLine",
    "attributes": {},
    "points": [...]
  }
]
```

### 4. 坐标归一化
- 保存时：将像素坐标转换为归一化坐标（0-1范围）
- 加载时：将归一化坐标转换回像素坐标用于绘制
- 坐标格式：`{x: number, y: number}`

### 7. 界面优化
- 区域列表显示区域名称（大号字体）
- 鼠标悬停显示完整的区域信息（名称、类型）
- 区域卡片尺寸调整为 70x70 以容纳多个按钮
- 右上角红色按钮：删除区域
- 左下角灰色按钮：重置区域（仅已绘制的区域显示）
- 右下角黄色按钮：编辑区域名称
- 绘制中时，其他区域显示为灰色半透明状态
- 顶点显示为带白边的圆点，便于拖拽操作

## 使用流程

### 新增区域
1. 点击"区域绘制"按钮
2. 选择区域类型
3. 点击"新增"按钮
4. 在弹出的对话框中：
   - 查看区域类型（自动显示）
   - 输入区域名称（如：1、2、99等）
5. 确认后选中新增的区域
6. 点击"开始绘制"
7. 在视频画面上点击标记区域顶点
8. 点击"结束绘制"完成当前区域
9. 重复步骤2-8添加更多区域
10. 点击"保存区域"提交到数据库

### 编辑区域
1. 点击区域卡片右下角的黄色编辑按钮
2. 在弹出的对话框中可以修改：
   - 区域名称
   - 车道方向（仅车道区）
   - 车道类型（仅车道区）
   - 最低限速（仅车道区）
   - 最高限速（仅车道区）
3. 确认后自动更新显示和属性

### 重置区域
1. 点击已绘制区域卡片左下角的灰色重置按钮
2. 区域的绘制点将被清空
3. 可以重新选中该区域进行绘制

### 拖拽调整顶点
1. 将鼠标移动到区域的顶点上（光标会变为移动图标）
2. 按住鼠标左键拖拽顶点到新位置
3. 释放鼠标完成调整
4. 可以对已保存的区域和正在绘制的区域进行调整
5. 调整后需要点击"保存区域"才能提交到数据库

## 数据兼容性

- 自动识别并转换旧格式数据
- 支持归一化坐标和像素坐标的自动转换
- 保存时统一使用归一化坐标格式

## 注意事项

1. 区域名称必填，name 和 value 字段使用同一个值
2. 建议使用数字编号（如：1、2、99）
3. 车道区必须填写车道方向和车道类型
4. 最低限速和最高限速为可选字段，可以不填
5. 所有区域必须完成绘制才能保存
6. 保存的数据格式与 typejson 文件夹中的示例完全一致
7. 可以随时编辑区域属性，但需要重新保存才能提交到数据库
8. 拖拽调整顶点后，需要点击"保存区域"才能将修改提交到数据库
9. 拖拽时避免点击到顶点，否则不会添加新的顶点

## 界面说明

### 区域命名对话框
- **区域类型**：灰色禁用输入框，显示当前选择的区域类型
- **区域名称**：可编辑输入框，输入的值会同时赋给 name 和 value 字段
- **车道区专属字段**（仅当类型为"车道区"时显示）：
  - 车道方向：下拉选择（向上/向下/向右/向左）
  - 车道类型：下拉选择（行车道/应急车道/导流区）
  - 最低限速：数字输入框
  - 最高限速：数字输入框

### 区域卡片
- **主显示**：大号字体显示区域名称
- **右上角红色按钮**：删除该区域（任何时候都可以删除）
- **左下角灰色按钮**：重置区域（仅已绘制的区域显示）
- **右下角黄色按钮**：编辑区域名称（绘制中时禁用）
- **选中状态**：绿色背景 + 外发光效果
- **未选中状态**：蓝色背景
- **绘制中其他区域**：灰色背景 + 半透明 + 禁止点击
